<!doctype html>
<html>
<body>
<input id="pw" type="password" placeholder="type password">
<button id="check">Check</button>
<pre id="out"></pre>
<script>
async function sha1Hex(str) {
  const enc = new TextEncoder();
  const data = enc.encode(str);
  const hashBuffer = await crypto.subtle.digest('SHA-1', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2,'0')).join('').toUpperCase();
}

document.getElementById('check').addEventListener('click', async () => {
  const pw = document.getElementById('pw').value;
  if (!pw) { document.getElementById('out').textContent = 'type a password'; return; }
  const h = await sha1Hex(pw);
  const prefix = h.slice(0,5);
  const suffix = h.slice(5);
  const res = await fetch('http://localhost:8000/api/v1/pwned-range', {
    method:'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ prefix })
  });
  const data = await res.json();
  const found = data.results.find(r => r.suffix === suffix);
  document.getElementById('out').textContent = found ? `Pwned! Count: ${found.count}` : 'Not pwned';
});
</script>
</body>
</html>
